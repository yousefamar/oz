"use strict";var OZ={};(function(){function init(){renderer=new THREE.WebGLRenderer({antialias:!0}),renderer.setSize(self.canvasWidth=window.innerWidth,self.canvasHeight=window.innerHeight),camera=self.camera=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.01,1e4),window.addEventListener("resize",function(){camera.aspect=window.innerWidth/window.innerHeight,camera.updateProjectionMatrix(),renderer.setSize(self.canvasWidth=window.innerWidth,self.canvasHeight=window.innerHeight)},!1),document.body.appendChild(renderer.domElement),scene=self.scene=new self.GraphScene,scene.add(new THREE.AmbientLight(1118481)),scene.add(new THREE.DirectionalLight(16777215));var underLight=new THREE.DirectionalLight(16777215,.125);underLight.position.set(-1,-1,-1),scene.add(underLight);var underLight=new THREE.DirectionalLight(16777215,.125);underLight.position.set(-1,-1,1),scene.add(underLight);var underLight=new THREE.DirectionalLight(16777215,.125);underLight.position.set(1,-1,-1),scene.add(underLight);var underLight=new THREE.DirectionalLight(16777215,.125);underLight.position.set(1,-1,1),scene.add(underLight),camRig=self.camRig={yawObj:new THREE.Object3D,pitchObj:new THREE.Object3D},camRig.yawObj.add(camRig.pitchObj),camera.position.z=150,camera.lookAt(new THREE.Vector3),camRig.pitchObj.add(camera),scene.add(camRig.yawObj),scene.loadGraph(function(){self.gui.init(),self.input.init(),document.body.style.visibility="visible",setTimeout(tick,TICK_INTERVAL_MS),requestAnimationFrame(render)})}function tick(){setTimeout(tick,TICK_INTERVAL_MS),self.gui.statsTick.begin();var delta=tickClock.getDelta();scene.tick(delta),self.gui.statsTick.end()}function render(){requestAnimationFrame(render),self.gui.statsRender.begin();var delta=animClock.getDelta();scene.animate(delta),renderer.render(scene,camera),self.gui.statsRender.end()}var renderer,camera,camRig,scene,TICK_INTERVAL_MS=1e3/60,self=this,tickClock=new THREE.Clock,animClock=new THREE.Clock;this.main=function(){init()}}).call(OZ),OZ.graph={},OZ.GraphScene=function(){THREE.Scene.call(this),this.springSize=10,this.lastPulseTime=0},OZ.GraphScene.prototype=Object.create(THREE.Scene.prototype),OZ.GraphScene.prototype.loadGraph=function(callback){var self=this,socket=io.connect("cyan.io:80");socket.on("localGraph",function(graph){self.graph=graph;for(var tempIDMap={},i=0,len=graph.nodes.length;len>i;i++){var node=graph.nodes[i];node.linked={};var mesh=node.mesh=new THREE.Mesh(new THREE.SphereGeometry(1),new THREE.MeshPhongMaterial({color:65535}));mesh.position.set(200*Math.random()-100,200*Math.random()-100,200*Math.random()-100),mesh.netForce=new THREE.Vector3,mesh.node=node,self.add(mesh),tempIDMap[node.id]=node}for(var i=0,len=graph.links.length;len>i;i++){var link=graph.links[i];tempIDMap[link.source].linked[link.target]=link.targetNode=tempIDMap[link.target],tempIDMap[link.target].linked[link.source]=link.sourceNode=tempIDMap[link.source];var geometry=new THREE.Geometry;geometry.vertices.push(tempIDMap[link.source].mesh.position),geometry.vertices.push(tempIDMap[link.target].mesh.position),link.mesh=new THREE.Line(geometry,new THREE.LineBasicMaterial({color:12632256,transparent:!0,opacity:.5})),self.add(link.mesh)}self.focusedNode=graph.nodes[0],callback()}),socket.emit("move",0)},OZ.GraphScene.prototype.tick=function(){for(var i=0,len0=this.graph.nodes.length;len0>i;i++)for(var node0=this.graph.nodes[i],mesh0=node0.mesh,j=i+1,len1=this.graph.nodes.length;len1>j;j++){var node1=this.graph.nodes[j],mesh1=node1.mesh,dist=mesh0.position.distanceTo(mesh1.position)||1e-4,distSq=dist*dist,distX=mesh0.position.x-mesh1.position.x||1e-4,distY=mesh0.position.y-mesh1.position.y||1e-4,distZ=mesh0.position.z-mesh1.position.z||1e-4,dirX=distX/dist,dirY=distY/dist,dirZ=distZ/dist;if(mesh0.netForce.x+=dirX/distSq,mesh0.netForce.y+=dirY/distSq,mesh0.netForce.z+=dirZ/distSq,mesh1.netForce.x-=dirX/distSq,mesh1.netForce.y-=dirY/distSq,mesh1.netForce.z-=dirZ/distSq,node1.id in node0.linked){var force=.01*(dist-this.springSize);mesh1.netForce.x+=dirX*force,mesh1.netForce.y+=dirY*force,mesh1.netForce.z+=dirZ*force,mesh0.netForce.x-=dirX*force,mesh0.netForce.y-=dirY*force,mesh0.netForce.z-=dirZ*force}}for(var i=0,len0=this.graph.nodes.length;len0>i;i++){var mesh=this.graph.nodes[i].mesh;mesh.position.add(mesh.netForce),mesh.netForce.set(0,0,0)}for(var i=0,len0=this.graph.links.length;len0>i;i++){var link=this.graph.links[i];link.mesh.geometry.vertices[0].copy(link.sourceNode.mesh.position),link.mesh.geometry.vertices[1].copy(link.targetNode.mesh.position),link.mesh.geometry.verticesNeedUpdate=!0}var camSpeed=.05;OZ.camRig.yawObj.position.x+=camSpeed*(this.focusedNode.mesh.position.x-OZ.camRig.yawObj.position.x),OZ.camRig.yawObj.position.y+=camSpeed*(this.focusedNode.mesh.position.y-OZ.camRig.yawObj.position.y),OZ.camRig.yawObj.position.z+=camSpeed*(this.focusedNode.mesh.position.z-OZ.camRig.yawObj.position.z),this.springSize<10&&(this.springSize+=2)},OZ.GraphScene.prototype.animate=function(delta){this.isPulseEnabled&&(this.lastPulseTime+=delta,this.lastPulseTime>5&&(this.springSize=-10,this.lastPulseTime=0))},OZ.GraphScene.prototype.setHoveredNode=function(node){node!==this.hoveredNode&&(this.hoveredNode&&(this.hoveredNode.scale.set(1,1,1),this.hoveredNode.material.color.setHex(65535)),node&&(node.scale.set(2,2,2),node.material.color.setHex(16776960),OZ.gui.setNodeText(node.node.text)),this.hoveredNode=node)},OZ.gui={init:function(){var overlay=document.getElementById("overlay");this.statsTick=new Stats,this.statsRender=new Stats,overlay.insertBefore(this.statsRender.domElement,overlay.firstChild),overlay.insertBefore(this.statsTick.domElement,overlay.firstChild)},setNodeText:function(text){document.getElementById("nodeText").innerHTML=text}},OZ.input={init:function(){document.addEventListener("mousedown",this.mousedown,!1),document.addEventListener("touchstart",function(event){event.preventDefault(),this.mousedown(event.targetTouches[0])},!1),document.addEventListener("mousemove",this.mousemove,!1),document.addEventListener("touchmove",function(event){this.mousemove(event.targetTouches[0])},!1),document.addEventListener("mouseup",this.mouseup,!1),document.addEventListener("touchend",function(event){this.mouseup(event.targetTouches[0])},!1),document.addEventListener("mousewheel",this.mousewheel,!1),document.addEventListener("DOMMouseScroll",this.mousewheel,!1)},isMouseDown:!1,mousedown:function(event){OZ.input.mouseX=event.offsetX||event.layerX||0,OZ.input.mouseY=event.offsetY||event.layerY||0,OZ.input.isMouseDown=!0,OZ.scene.hoveredNode&&(OZ.scene.focusedNode=OZ.scene.hoveredNode.node)},mousemove:function(){var rotDegFactor=.5*Math.PI/180,projector=new THREE.Projector;return function(event){var mouseX=event.offsetX||event.layerX||0,mouseY=event.offsetY||event.layerY||0;if(OZ.input.isMouseDown)OZ.camRig.yawObj.rotation.y-=rotDegFactor*(mouseX-OZ.input.mouseX),OZ.camRig.pitchObj.rotation.x-=rotDegFactor*(mouseY-OZ.input.mouseY),OZ.camRig.pitchObj.rotation.x=Math.max(-Math.PI/2,Math.min(Math.PI/2,OZ.camRig.pitchObj.rotation.x)),OZ.scene.setHoveredNode(null);else{for(var ray=projector.pickingRay(new THREE.Vector3(2*mouseX/OZ.canvasWidth-1,-(2*mouseY/OZ.canvasHeight-1),.5),OZ.camera),objects=ray.intersectObjects(OZ.scene.children),nothingPicked=!0,i=0,len=objects.length;len>i;i++)if(objects[i].object instanceof THREE.Mesh){OZ.scene.setHoveredNode(objects[i].object),nothingPicked=!1;break}nothingPicked&&OZ.scene.setHoveredNode(null)}OZ.input.mouseX=mouseX,OZ.input.mouseY=mouseY}}(),mouseup:function(){OZ.input.isMouseDown=!1},mousewheel:function(event){event.preventDefault(),OZ.camera.position.z-=event.wheelDeltaY/12||4*-event.detail,OZ.camera.position.z=OZ.camera.position.z<10?10:OZ.camera.position.z>200?200:OZ.camera.position.z}};
//# sourceMappingURL=oz.min.js.map